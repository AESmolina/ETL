# ETL ТЗ

Описание задачи.
Разработать ETL процесс, получающий ежедневную выгрузку данных (предоставляется за 3 дня), загружающий ее в хранилище данных и ежедневно
строящий отчет.
Выгрузка данных.
Ежедневно некие информационные системы выгружают три следующих
файла:
1. Список транзакций за текущий день. Формат – CSV.
2. Список терминалов полным срезом. Формат – XLSX.
3. Список паспортов, включенных в «черный список» - с накоплением с начала месяца. Формат – XLSX.
<br>Сведения о картах, счетах и клиентах хранятся в СУБД PostgreSQL. 
<br>Реквизиты для подключения:
- Host: ************
- Port: 5432
- Database: bank
- User: bank_etl
- Password: ***********
<br>Вам предоставляется выгрузка за последние три дня, ее надо обработать.
<br>Структура хранилища.
<br>В качестве хранилища выступает база edu.
<br>Данные должны быть загружены в хранилище со следующей структурой
(имена сущностей указаны по существу, без особенностей правил нейминга,
указанных далее):
<br>![image](https://user-images.githubusercontent.com/99192009/208439832-75388083-61db-4234-bc42-ae97f2584576.png)
<br>Типы данных в полях можно изменять на однородные если для этого есть
необходимость. Имена полей менять нельзя. Ко всем таблицам SCD1 должны быть
добавлены технические поля create_dt, update_dt; ко всем таблицам SCD2
должны быть добавлены технические поля effective_from, effective_to,
deleted_flg.

<br>Построение отчета.

<br>По результатам загрузки ежедневно необходимо строить витрину
отчетности по мошенническим операциям. Витрина строится накоплением,
каждый новый отчет укладывается в эту же таблицу с новым report_dt.
<br>В витрине должны содержаться следующие поля:
- event_dt - Время наступления события. Если событие наступило по
результату нескольких действий – указывается время действия,
по которому установлен факт мошенничества.
- passport - Номер паспорта клиента, совершившего мошенническую
операцию.
- fio - ФИО клиента, совершившего мошенническую операцию.
- phone - Номер телефона клиента, совершившего мошенническую
операцию.
- event_type - Описание типа мошенничества.
- report_dt - Время построения отчета.
<br>Признаки мошеннических операций.
1. Совершение операции при просроченном или заблокированном паспорте.
2. Совершение операции при недействующем договоре.
3. Совершение операций в разных городах в течение одного часа.
4. Попытка подбора суммы. В течение 20 минут проходит более 3х операций со следующим шаблоном – каждая последующая меньше предыдущей, при этом
отклонены все кроме последней. Последняя операция (успешная) в такой цепочке
считается мошеннической.

<br>Правила именования таблиц.

<br>Необходимо придерживаться следующих правил именования (для
автоматизации проверки):
- CODE_STG_TABLE_NAME - Таблицы для размещения
стейджинговых таблиц
(первоначальная загрузка),
промежуточное выделение
инкремента если
требуется.
Имя таблиц можно
выбирать произвольное, но
смысловое.
- CODE_DWH_FACT_TABLE_NAME Таблицы фактов,
загруженных в хранилище.
Имя таблиц – как в ER
диаграмме.
- CODE_DWH_DIM_TABLE_NAME Таблицы измерений,
хранящиеся в формате
SCD1.Имя таблиц – как в ER
диаграмме.
- CODE_DWH_DIM_TABLE_NAME_HIST Таблицы измерений,
хранящиеся в SCD2
формате.
Имя таблиц – как в ER
диаграмме.
- CODE_REP_FRAUD Таблица с отчетом.
- CODE_META_TABLE_NAME Таблицы для хранения
метаданных.
Имя таблиц можно
выбирать произвольное, но
смысловое.
- CODE - 4 буквы персонального кода.

<br>Обработка файлов

<br>Выгружаемые файлы именуются согласно следующему шаблону:
- transactions_DDMMYYYY.txt
- passport_blacklist_DDMMYYYY.xlsx
- terminals_DDMMYYYY.xlsx
<br>Предполагается что в один день приходит по одному такому файлу. После
загрузки соответствующего файла он должен быть переименован в файл с
расширением .backup чтобы при следующем запуске файл не искался и
перемещен в каталог archive:
- transactions_DDMMYYYY.txt.backup
- passport_blacklist_DDMMYYYY.xlsx.backup
- terminals_DDMMYYYY.xlsx.backup

<br>Проверка результата.

<br> zip-архив, содержащий следующие файлы и каталоги:
- main.py 
Основной процесс
обработки.
- файлы с данными 
- main.ddl Файл с SQL кодом для
создания всех
необходимых объектов
в базе edu.
- main.cron 
Файл для постановки процесса на
расписание, в формате
crontab
- archive 
Пустой католог, сюда должны
перемещаться
отработанные файлы
- sql_scripts  SQL
скрипты, вынесенные в
отдельные файлы.

<br>Имя архива – 4 буквы  кода с расширением .zip. 

<br>Код в вашем каталоге на ETL сервере.На сервере  должен быть создан каталог
/home/demipt3/code/project, где code - 4 буквы вашего кода в нижнем
регистре В каталоге должны быть
выложены точно те же файлы и каталоги. На файл main.py должны быть выданы права на исполнение.

- smla_rep_fraud_20221219.txt - отчет за 3 дня
